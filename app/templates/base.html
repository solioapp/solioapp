<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ platform_name }}{% endblock %}</title>
    <meta name="description" content="{% block description %}Crowdfunding platform on Solana blockchain{% endblock %}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.description() }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ url_for('static', filename='images/solio-main.png', _external=True) }}{% endblock %}">
    <meta property="og:site_name" content="Solio">

    <!-- Twitter -->
    <meta name="twitter:card" content="{% block twitter_card %}summary_large_image{% endblock %}">
    <meta name="twitter:url" content="{{ request.url }}">
    <meta name="twitter:title" content="{% block twitter_title %}{{ self.title() }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ self.description() }}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ url_for('static', filename='images/solio-main.png', _external=True) }}{% endblock %}">

    <!-- Additional SEO -->
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#9945FF">
    <link rel="canonical" href="{{ request.url }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

    <!-- 3D Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block extra_css %}{% endblock %}

    <!-- CSRF Token -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="{{ url_for('main.index') }}" class="navbar-brand">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Solio" class="navbar-logo">
            </a>

            <div class="navbar-menu">
                <a href="{{ url_for('projects.list_projects') }}" class="nav-link">Projects</a>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('projects.create') }}" class="nav-link">Create Project</a>
                {% endif %}
                <a href="{{ url_for('main.about') }}" class="nav-link">About</a>
                <a href="{{ url_for('main.roadmap') }}" class="nav-link">Roadmap</a>
                <div class="nav-social-icons">
                    <a href="https://pump.fun/coin/AppUx1Y2ceZbeRbx81peSUAwowSbacDSJhJPyiJupump" target="_blank" rel="noopener" class="nav-social-link" title="DEX">
                        <img src="{{ url_for('static', filename='images/dex.png') }}" alt="DEX" class="nav-social-icon">
                    </a>
                    <a href="https://t.me/solioapp" target="_blank" rel="noopener" class="nav-social-link" title="Telegram">
                        <img src="{{ url_for('static', filename='images/telegram.png') }}" alt="Telegram" class="nav-social-icon">
                    </a>
                    <a href="https://x.com/SolioSol" target="_blank" rel="noopener" class="nav-social-link" title="X/Twitter">
                        <img src="{{ url_for('static', filename='images/x.png') }}" alt="X" class="nav-social-icon">
                    </a>
                </div>
            </div>

            <div class="navbar-actions">
                {% if current_user.is_authenticated %}
                    <!-- Notification Bell -->
                    <div class="notification-bell-wrapper">
                        <a href="{{ url_for('notifications.list_notifications') }}" class="notification-bell" title="Notifications">
                            <svg viewBox="0 0 24 24" width="22" height="22">
                                <path fill="currentColor" d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                            </svg>
                            {% if unread_notifications > 0 %}
                            <span class="notification-badge">{{ unread_notifications if unread_notifications < 100 else '99+' }}</span>
                            {% endif %}
                        </a>
                    </div>

                    <div class="user-menu">
                        <button class="user-menu-trigger" id="userMenuTrigger">
                            {% if current_user.profile_image %}
                                <img src="{{ current_user.profile_image }}" alt="{{ current_user.username }}" class="user-avatar">
                            {% else %}
                                <div class="user-avatar-placeholder">{{ current_user.username[0].upper() }}</div>
                            {% endif %}
                            <span class="user-name">{{ current_user.username }}</span>
                            <svg class="chevron" viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                            </svg>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="{{ url_for('profile.dashboard') }}" class="dropdown-item">Dashboard</a>
                            <a href="{{ url_for('profile.edit') }}" class="dropdown-item">Settings</a>
                            {% if current_user.is_admin %}
                            <a href="{{ url_for('admin.dashboard') }}" class="dropdown-item">Admin Panel</a>
                            {% endif %}
                            <hr class="dropdown-divider">
                            <a href="{{ url_for('auth.logout') }}" class="dropdown-item">Log Out</a>
                        </div>
                    </div>
                {% else %}
                    <button class="btn btn-outline" id="connectWalletBtn">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        </svg>
                        Connect Wallet
                    </button>
                    <a href="{{ url_for('auth.login') }}" class="btn btn-primary">Log In</a>
                {% endif %}
            </div>

            <button class="navbar-toggle" id="navbarToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="{{ url_for('projects.list_projects') }}" class="mobile-nav-link">Projects</a>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('projects.create') }}" class="mobile-nav-link">Create Project</a>
            <a href="{{ url_for('notifications.list_notifications') }}" class="mobile-nav-link">
                Notifications
                {% if unread_notifications > 0 %}
                <span class="mobile-notification-badge">{{ unread_notifications }}</span>
                {% endif %}
            </a>
            <a href="{{ url_for('profile.dashboard') }}" class="mobile-nav-link">Dashboard</a>
            <a href="{{ url_for('profile.edit') }}" class="mobile-nav-link">Settings</a>
            {% if current_user.is_admin %}
                <a href="{{ url_for('admin.dashboard') }}" class="mobile-nav-link">Admin Panel</a>
            {% endif %}
            <a href="{{ url_for('auth.logout') }}" class="mobile-nav-link">Log Out</a>
        {% else %}
            <a href="{{ url_for('auth.login') }}" class="mobile-nav-link">Log In</a>
            <a href="{{ url_for('auth.register') }}" class="mobile-nav-link">Register</a>
        {% endif %}
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash flash-{{ category }}">
                        <span>{{ message }}</span>
                        <button class="flash-close">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="{{ url_for('main.index') }}" class="footer-logo">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Solio" class="footer-logo-img">
                    </a>
                    <p class="footer-tagline">Crowdfunding on Solana blockchain</p>
                </div>

                <div class="footer-links">
                    <h4>Platform</h4>
                    <a href="{{ url_for('projects.list_projects') }}">Browse Projects</a>
                    <a href="{{ url_for('projects.create') }}">Create Project</a>
                    <a href="{{ url_for('main.about') }}">About</a>
                </div>

                <div class="footer-links">
                    <h4>Support</h4>
                    <a href="{{ url_for('main.faq') }}">FAQ</a>
                    <a href="{{ url_for('main.terms') }}">Terms</a>
                    <a href="{{ url_for('main.privacy') }}">Privacy</a>
                    <a href="mailto:{{ config.SUPPORT_EMAIL or 'support@solio.io' }}">Contact</a>
                </div>

                <div class="footer-links">
                    <h4>Follow Us</h4>
                    <a href="#" target="_blank">Twitter/X</a>
                    <a href="#" target="_blank">Discord</a>
                    <a href="#" target="_blank">Telegram</a>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Solio. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Wallet Connection Modal -->
    <div class="modal" id="walletModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connect Wallet</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="wallet-options">
                    <button class="wallet-option" data-wallet="phantom">
                        <img src="{{ url_for('static', filename='images/phantom.svg') }}" alt="Phantom" onerror="this.style.display='none'">
                        <span>Phantom</span>
                    </button>
                    <button class="wallet-option" data-wallet="solflare">
                        <img src="{{ url_for('static', filename='images/solflare.svg') }}" alt="Solflare" onerror="this.style.display='none'">
                        <span>Solflare</span>
                    </button>
                    <button class="wallet-option" data-wallet="backpack">
                        <img src="{{ url_for('static', filename='images/backpack.svg') }}" alt="Backpack" onerror="this.style.display='none'">
                        <span>Backpack</span>
                    </button>
                </div>
                <p class="wallet-info">
                    By connecting your wallet, you'll be logged into the platform.
                    We never send transactions without your approval.
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text" id="loadingText">Loading...</p>
        </div>
    </div>

    <!-- Transaction Progress Modal -->
    <div class="modal" id="txProgressModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content tx-progress-modal">
            <div class="tx-progress-header">
                <h3>Processing Transaction</h3>
            </div>
            <div class="tx-progress-body">
                <div class="tx-steps">
                    <div class="tx-step" data-step="prepare">
                        <div class="tx-step-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="tx-step-content">
                            <span class="tx-step-title">Preparing transaction</span>
                            <span class="tx-step-desc">Creating transfer instruction...</span>
                        </div>
                    </div>
                    <div class="tx-step" data-step="sign">
                        <div class="tx-step-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="tx-step-content">
                            <span class="tx-step-title">Approve in wallet</span>
                            <span class="tx-step-desc">Please confirm the transaction in your wallet</span>
                        </div>
                    </div>
                    <div class="tx-step" data-step="send">
                        <div class="tx-step-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="tx-step-content">
                            <span class="tx-step-title">Sending to network</span>
                            <span class="tx-step-desc">Broadcasting transaction to Solana...</span>
                        </div>
                    </div>
                    <div class="tx-step" data-step="confirm">
                        <div class="tx-step-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="tx-step-content">
                            <span class="tx-step-title">Confirming</span>
                            <span class="tx-step-desc">Waiting for network confirmation...</span>
                        </div>
                    </div>
                    <div class="tx-step" data-step="verify">
                        <div class="tx-step-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="tx-step-content">
                            <span class="tx-step-title">Verifying</span>
                            <span class="tx-step-desc">Recording donation on platform...</span>
                        </div>
                    </div>
                </div>
                <div class="tx-signature" id="txSignature" style="display: none;">
                    <span class="tx-signature-label">Transaction:</span>
                    <a href="#" target="_blank" class="tx-signature-link" id="txSignatureLink">View on Solscan</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script>
        // Base58 encode function
        window.base58Encode = function(bytes) {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            const uint8 = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes);
            let result = '';
            let digits = [0];
            for (let i = 0; i < uint8.length; i++) {
                let carry = uint8[i];
                for (let j = 0; j < digits.length; j++) {
                    carry += digits[j] << 8;
                    digits[j] = carry % 58;
                    carry = (carry / 58) | 0;
                }
                while (carry) {
                    digits.push(carry % 58);
                    carry = (carry / 58) | 0;
                }
            }
            for (let i = 0; i < uint8.length && uint8[i] === 0; i++) {
                result += ALPHABET[0];
            }
            for (let i = digits.length - 1; i >= 0; i--) {
                result += ALPHABET[digits[i]];
            }
            return result;
        };
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/wallet.js') }}"></script>
    <script src="{{ url_for('static', filename='js/validation.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
